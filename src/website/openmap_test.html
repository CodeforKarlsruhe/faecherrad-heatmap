<!doctype html>
<html lang="en">
  <head>
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
 <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
 <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
 <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>

<script>

 $(function() {
$( "#slider" ).slider( {
"min": 10,
"max": 40,
change: function( event, ui ) {
    console.log( "changed ");
    console.log(ui.value);
}
 } );

});

var map;
var g_bikeData;

$( document ).ready(function() {


console.log('load start');

// create a map in the "map" div, set the view to a given place and zoom
map = L.map('map').setView([49.010059889405966, 8.3973967004567,], 13);

// add an OpenStreetMap tile layer
L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

$("#selectBikeBox").change(function() {
    console.log("... updating ... with bike " + $(this).val() );
    selectBike ( parseInt( $(this).val() ) );
});

// add a marker in the given location, attach some popup content to it and open the popup
/*L.marker([51.5, -0.09]).addTo(map)
    .bindPopup('A pretty CSS3 popup. <br> Easily customizable.')
    .openPopup();
*/
/*
var marker1 = L.marker([1.5, -0.09], {time: "2013-01-22 08:42:26+01"}).addTo(map);
var marker2 = L.marker([51.6, -0.09], {time: "2013-01-22 10:00:26+01"});
var marker3 = L.marker([51.7, -0.09], {time: "2013-01-22 10:03:29+01"});

var pointA = new L.LatLng(51.8, -0.09);
var pointB = new L.LatLng(51.9, -0.2);
var pointList = [pointA, pointB];

var polyline = new L.Polyline(pointList, {
    time: "2013-01-22 10:24:59+01",
    color: 'red',
    weight: 3,
    opacity: 1,
    smoothFactor: 1
});

var geojsonFeature = {
    "type": "Feature",
    "properties": {
        "name": "Coors Field",
        "amenity": "Baseball Stadium",
        "popupContent": "This is where the Rockies play!"
    },
    "geometry": {
        "type": "Point",
        "coordinates": [-104.99404, 39.75621]
    }
};


L.geoJson(geojsonFeature).addTo(map);*/
/*
layerGroup = L.layerGroup([marker1, marker2, marker3, polyline ]);
var sliderControl = L.control.sliderControl({layer:layerGroup});
map.addControl(sliderControl);
sliderControl.startSlider();
console.log('load done');*/
});


function updateBikeList ( ) {
    selectBox = $( "#selectBikeBox" );
    selectBox.empty();

    $.each( g_bikeData, function( key, val ) {

       // L.marker([val[1], val[2]], {time: "2013-01-22 08:42:26+01"}).addTo(map);
        $("<option/>").val(key).text("Bike " + key).appendTo("#selectBikeBox");
    });
}

$.getJSON( "https://xhochy.com/nextbike/db.json", function( data ) {
//$.getJSON( "bikes.json", function( data ) {
var items = [];
g_bikeData = data; 
console.log("Json loaded !");
updateBikeList();
});


//$.each( data, function( key, val ) {
//items.push( "<li id='" + key + "'>" + val + "</li>" );



function selectBike( bike_number ){ 

// just for first bike ...

    $.each( g_bikeData[bike_number], function( key, val ) {
        console.log(val);        
        L.marker([val[1], val[2]], { title: "Timestamp " + val[0] }).addTo(map);
    });

};



</script>

<style>

#map { height: 600px; }
</style>

    <title>KA Bikes</title>
  </head>
  <body>
    <h2>KA Bikes</h2>


  <select id="selectBikeBox">
    <option>... loading ...</option>
  </select>
<div id="slider"></div>
 <div id="map"></div>
  </body>
</html>

